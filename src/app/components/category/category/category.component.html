<div class="modal-header">
	<h4 class="modal-title">Agregar Rubro</h4>
	<button type="button" class="close" aria-label="Close" (click)="activeModal.dismiss('close_click')">
		<span aria-hidden="true">&times;</span>
	</button>
</div>
<section class="container-fluid">
	<div class="center-content" *ngIf="alertMessage !== ''">
		<ngb-alert [type]="alertConfig.type" [dismissible]="alertConfig.dismissible" (close)="alertMessage=''">
			{{alertMessage}}
		</ngb-alert>
	</div>
	<form [formGroup]="categoryForm" #formAddCategory="ngForm" (ngSubmit)="addCategory()" autocomplete="off">
		<div class="modal-body">
			<ngb-tabset [orientation]="orientation">
				<ngb-tab title="Datos principales">
					<ng-template ngbTabContent>
						<div class="row tab-content">
							<div class="form-group col-md-12">
								<div class="row">
									<div class="form-group col-md-2">
										<label for="order" class="control-label">Orden:</label>
										<input type="number" class="form-control" formControlName="order" name="order"
											id="order" [focus]="focusEvent" [readonly]="readonly" />
										<div *ngIf="formErrors.order" class="alert alert-danger">
											{{ formErrors.order }}
										</div>
									</div>
									<div class="form-group col-md-6">
										<label for="description" class="control-label">Descripción:</label>
										<input type="text" class="form-control" formControlName="description"
											name="description" id="description" [focus]="focusEvent"
											[readonly]="readonly" />
										<div *ngIf="formErrors.description" class="alert alert-danger">
											{{ formErrors.description }}
										</div>
									</div>
									<div class="form-group col-md-4">
										<div class="row">
											<div class="col-md-12">
												<label class="custom-file-label btn btn-action"
													for="customFileLang">Seleccionar Imagen</label>
												<input type="file" class="custom-file-input" lang="es" accept="image/*"
													id="customFileLang" (change)="fileChangeEvent($event)" />
											</div>
										</div>
										<div class="row">
											<div class="col-md-12">
												<img [src]="imageURL" height="120" width="120">
											</div>
										</div>
									</div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-12">
										<label for="parent" class="control-label">Padre</label>
										<select class="form-control" formControlName="parent">
                                            <option [ngValue]="null" [disabled]="readonly"></option>
                                            <option *ngFor="let category of categories"
                                                    [selected]="(category.parent && category.parent._id && parent._id===category.parent._id) ||
                                                                (category.parent && parent._id===category.parent)"
                                                    [value]="category._id"
                                                    [disabled]="readonly">
                                                    <b>{{category.description}}</b></option>
										</select>
									</div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-12 center-content">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" formControlName="favourite"
                                                value="" id="favourite" name="favourite">
                                            <label class="form-check-label" for="favourite"
                                                title="Si es un categoria destacada, aparecerá primero en la lista de categorias en el pedido para agregar">
                                                <b>Rubro destacado</b>
                                            </label>
                                        </div>
                                    </div>
                                </div>
							</div>
						</div>
					</ng-template>
				</ngb-tab>
				<ngb-tab title="Configuracion">
					<ng-template ngbTabContent>
						<div class="row tab-content">
							<div class="form-group col-md-12">
								<div class="row">
									<div class="form-group col-md-12">
										<label for="visibleInvoice" class="control-label">¿El rubro es visible en la factura?</label>
										<select class="form-control" formControlName="visibleInvoice">
											<option value="true" [disabled]="readonly">Si</option>
											<option value="false" selected [disabled]="readonly" >No</option>
										</select>
									</div>
								</div>
								<div class="row">
									<div class="form-group col-md-12">
										<label for="visibleOnSale" class="control-label">¿El rubro es visible en la venta?</label>
										<select class="form-control" formControlName="visibleOnSale">
											<option value="true" selected [disabled]="readonly">Si</option>
											<option value="false" [disabled]="readonly">No</option>
										</select>
									</div>
								</div>
								<div class="row">
									<div class="form-group col-md-12">
										<label for="visibleOnPurchase" class="control-label">¿El rubro es visible en la compra?</label>
										<select class="form-control" formControlName="visibleOnPurchase">
											<option value="true" selected [disabled]="readonly">Si</option>
											<option value="false" [disabled]="readonly">No</option>
										</select>
									</div>
								</div>
                                <div class="row">
                                    <div class="form-group col-md-3">
                                        <label for="ecommerceEnabled" class="control-label">Publicar</label>
                                        <select class="form-control" formControlName="ecommerceEnabled">
                                            <option [ngValue]="true" [disabled]="readonly">Si</option>
                                            <option [ngValue]="false" [disabled]="readonly">No</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-9">
                                        <label>Aplicaciones</label>
                                        <br>
                                        <label formArrayName="applications"
                                            *ngFor="let order of categoryForm.get('applications')['controls']; let i = index"
                                            style="margin-right: 20px; font-size: 20px;">
                                            <input type="checkbox" [formControlName]="i" />
                                            {{applications[i].name}}
                                        </label>
                                    </div>
                                </div>
                                <div class="row">
									<div class="form-group col-md-12">
										<label for="isRequiredOptional" class="control-label">¿Es obligatorio si esta en opcional?</label>
										<select class="form-control" formControlName="isRequiredOptional">
											<option value="true" [disabled]="readonly">Si</option>
											<option value="false" selected [disabled]="readonly">No</option>
										</select>
									</div>
								</div>
							</div>
						</div>
					</ng-template>
				</ngb-tab>
			</ngb-tabset>
		</div>
        <div class="modal-footer" *ngIf="operation !== 'view'">
            <button type="button" class="btn btn-light" (click)="activeModal.dismiss('cancel')">Cancelar</button>
            <button type="submit" class="btn btn-primary" [disabled]="!categoryForm.valid || loading" *ngIf="operation !== 'delete'">
              <i class="fa" [ngClass]="{'fa-save':!loading, 'fa-spinner fa-spin':loading}"></i>
              <span *ngIf="!loading">Guardar</span>
              <span *ngIf="loading">Espere por favor</span>
            </button>
            <button type="button"
                    class="btn btn-danger"
                    *ngIf="operation === 'delete'"
                    [disabled]="!categoryForm.valid || loading"
                    (click)="deleteCategory()">
              <i class="fa" [ngClass]="{'fa-trash':!loading, 'fa-spinner fa-spin':loading}"></i>
              <span *ngIf="!loading">Eliminar</span>
              <span *ngIf="loading">Espere por favor</span>
            </button>
        </div>
	</form>
</section>
