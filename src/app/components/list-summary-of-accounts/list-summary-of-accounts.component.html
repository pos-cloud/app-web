<section class="container-fluid" *ngIf="userType=='admin'">
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">Resúmenes de Cuentas
      <div class="pull-right">
        <span (click)="areFiltersVisible = !areFiltersVisible">
            <i class="btn btn-primary fa fa-filter" data-toggle="tooltip" data-placement="top" title="Aplicar Filtros"> Filtrar</i>
        </span>
      </div>
    </div>
    <div class="card-block table-responsive">
      <div class="center-content" *ngIf="alertMessage !== '' && !areTablesEmpty">
        <ngb-alert [type]="alertConfig.type" [dismissible]="alertConfig.dismissible" (close)="alertMessage=''">
          {{alertMessage}}
        </ngb-alert>
      </div>
      <div class="row container-filter">
        <div class="col-md-2 offset-md-3">
          <label for="startDate" class="control-label">
            <b>Fecha Desde:</b>
          </label>
          <input type="date" class="form-control" name="startDate" min="2000-01-01" [(ngModel)]="startDate" />
        </div>
        <div class="col-md-2">
          <label for="endDate" class="control-label">
            <b>Fecha Hasta:</b>
          </label>
          <input type="date" class="form-control" name="endDate" min="2000-01-01" [(ngModel)]="endDate" />
        </div>
        <div class="col-md-2" (click)="refresh()">
          <label for="btn-action" class="control-label"><b>Acción:</b></label>
          <span class="form-control btn-action center-content">
            <i [ngClass]="{'fa fa-refresh fa-spin':loading}"></i>Actualizar
          </span>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <table class="table table-hover">
            <thead>
              <tr>
                <th></th>
                <th class="align-center" (click)="orderBy('_id','companyName')">Nombre</th>
                <th class="align-center" (click)="orderBy('_id','companyType')">Tipo</th>
                <th class="align-center" (click)="orderBy('_id','identificationValue')">Identificador</th>
                <th class="align-center" (click)="orderBy('_id','companyAddress')">Dirección</th>
                <th class="align-center" (click)="orderBy('_id','companyPhones')">Teléfono</th>
                <th class="align-center" (click)="orderBy('_id','companyEmails')">Email</th>
                <th class="align-center" (click)="orderBy('balance')">Saldo</th>
              </tr>
              <tr *ngIf="areFiltersVisible" class="filters">
                <th></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterCompanyName" placeholder="Nombre..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterCompanyType" placeholder="Tipo..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterIdentificationValue" placeholder="Identificador..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterCompanyAddress" placeholder="Dirección..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterCompanyPhones" placeholder="Teléfono..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterCompanyEmails" placeholder="Email..." ></th>
                <th><input type="text" class="form-control" [(ngModel)]= "filterBalance" placeholder="Saldo..." ></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of items | filter: filterCompanyName:'companyName':'_id'
                                            | filter: filterCompanyType:'companyType':'_id'
                                            | filter: filterIdentificationValue:'identificationValue':'_id'
                                            | filter: filterCompanyAddress:'companyAddress':'_id'
                                            | filter: filterCompanyPhones:'companyPhones':'_id'
                                            | filter: filterCompanyEmails:'companyEmails':'_id'
                                            | filter: filterBalance:'balance'
                                            | orderBy: orderTerm: propertyTerm
                                            | paginate: { itemsPerPage: itemsPerPage,
                                                          currentPage: p,
                                                          totalItems: totalItems
                                                        }"
                  [ngClass]="{'credit':item.balance>0,'debit':item.balance<0}">
                <td align="left" width="130">
                  <button type="button" class="btn btn-success  btn-sm" (click)="viewDetailCureentAccount(item._id.company)" title="Ver"><i class="fa fa-eye"></i></button>
                  <a *ngIf="item._id.companyPhones" class="btn btn-default btn-sm icon-ws" href="https://web.whatsapp.com/send?phone=54{{item._id.companyPhones}}&text=''" target="_blank"><i class="fa fa-whatsapp"></i></a>
                </td>
                <td class="flat">{{ item._id.companyName }}</td>
                <td class="flat">{{ item._id.companyType }}</td>
                <td class="flat align-center">{{ item._id.identificationValue }}</td>
                <td class="flat">{{ item._id.companyAddress }}</td>
                <td class="flat">{{ item._id.companyPhones }}</td>
                <td class="flat">{{ item._id.companyEmails }}</td>
                <td class="flat align-right" *ngIf="item.balance>=0">
                  <strong>{{item.balance | currency:'USD':'1.2-2'}}</strong>
                </td>
                <td class="flat align-right" *ngIf="item.balance<0">
                  <strong>{{item.balance | currency:'USD':'1.2-2'}}</strong>
                </td>
              </tr>
              <tr align="center" *ngIf="items.length === 0 && !loading">
                <td colspan="9">No se encontraron cuentas</td>
              </tr>
            </tbody>
            <tfoot>
              <td>
                <strong>Totales</strong>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <b>
                  ${{ calculateTotal(items
                  | filter: filterCompanyName:'companyName':'_id'
                  | filter: filterCompanyType:'companyType':'_id'
                  | filter: filterIdentificationValue:'identificationValue':'_id'
                  | filter: filterCompanyAddress:'companyAddress':'_id'
                  | filter: filterCompanyPhones:'companyPhones':'_id'
                  | filter: filterCompanyEmails:'companyEmails':'_id'
                  | filter: filterBalance:'balance'  , 'balance', '1.2-2') }}
                </b>
              </td>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="card-footer bg-primary">
    <div class="row">
      <div class="col-md-10">
        <pagination-controls class="my-pagination" (pageChange)="p=$event" #api previousLabel="Ant." nextLabel="Sig."
          autoHide="true">
        </pagination-controls>
      </div>
      <div class="form-group col-md-2">
        <select class="form-control" [(ngModel)]="itemsPerPage">
          <option [value]="5">Mostrar 5 Registros</option>
          <option [value]="10">Mostrar 10 Registros</option>
          <option [value]="15">Mostrar 15 Registros</option>
          <option [value]="20">Mostrar 20 Registros</option>
          <option [value]="50">Mostrar 50 Registros</option>
          <option [value]="100">Mostrar 100 Registros</option>
        </select>
      </div>
    </div>
  </div>
</section>
