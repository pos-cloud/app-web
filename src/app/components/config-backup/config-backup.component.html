<section class="container-fluid" *ngIf="userType=='admin'">
  <div class="center-content" *ngIf="alertMessage !== ''">
    <ngb-alert [type]="alertConfig.type" [dismissible]="alertConfig.dismissible" (close)="alertMessage=''">
      {{alertMessage}}
    </ngb-alert>
  </div>
  <!--license-->
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">Licencia</div>
    <div class= 'card-block'>
      <form [formGroup]="" #formAddConfig="ngForm" (ngSubmit)="downloadlicense()" autocomplete="off">
        <div class= "row">
          <div class="form-group col-md-3" *ngIf="config">
            <b>Vence {{ config.expirationLicense | dateFormat:'DD/MM/YYYY' }}</b>
          </div>
          <div class= "form-group col-md-9">
            <button type="submit" class="btn btn-primary" [disabled]="loadingLicense" (click)="generateLicensePayment()">
              <i class="fa" [ngClass]="{'fa-refresh':!loadingLicense, 'fa-spinner fa-spin':loadingLicense}"></i>
              <span *ngIf="!loadingLicense">Renovar Licencia</span>
              <span *ngIf="loadingLicense">Espere por favor</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!--Company-->
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">Datos de la Empresa</div>
    <div class="card-block">
      <form [formGroup]="configFormCompany" #formAddConfig="ngForm" (ngSubmit)="addConfigCompany()" autocomplete="off">
        <div class="row">
          <div class="form-group col-md-2">
            <img [src]="imageURL" height="150" width="300">
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-3">
            <div class="custom-file">
              <label class="custom-file-label btn btn-action" for="customFileLang">Cambiar Imagen</label>
              <input type="file" class="custom-file-input" lang="es" accept="image/*" id="customFileLang" (change)="fileChangeEvent($event)" />
            </div>
          </div>
          <div class="form-group col-md-3">
            <label class="btn btn-action" (click)="deletePicture()">Eliminar Imagen</label>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Razón Social</span>
              <input type="text" class="form-control" formControlName="companyName" name="companyName" id="companyName" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyName" class="alert alert-danger">
              {{ formErrors.companyName }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Nombre de fantasía</span>
              <input type="text" class="form-control" formControlName="companyFantasyName" name="companyFantasyName" id="companyFantasyName" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyFantasyName" class="alert alert-danger">
              {{ formErrors.companyFantasyName }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">CUIT</span>
              <input type="text" class="form-control" formControlName="companyCUIT" name="companyCUIT" id="companyCUIT" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyCUIT" class="alert alert-danger">
              {{ formErrors.companyCUIT }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Condición de IVA:</span>
              <select class="form-control" formControlName="companyVatCondition" name="companyVatCondition" id="companyVatCondition">
                <option *ngFor="let vatCondition of vatConditions"
                        [selected]="config.companyVatCondition && vatCondition._id === config.companyVatCondition._id"
                        [value]="vatCondition._id">
                  {{vatCondition.description}}
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Fecha de inicio de actividades</span>
              <input type="text" class="form-control" formControlName="companyStartOfActivity" placeholder="DD/MM/AAAA" name="companyStartOfActivity" id="companyStartOfActivity" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyStartOfActivity" class="alert alert-danger">
              {{ formErrors.companyStartOfActivity }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Ingresos Brutos</span>
              <input type="text" class="form-control" formControlName="companyGrossIncome" name="companyGrossIncome" id="companyGrossIncome"
                aria-describedby="basic-addon1">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Dirección</span>
              <input type="text" class="form-control" formControlName="companyAddress" name="companyAddress" id="companyAddress" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyAddress" class="alert alert-danger">
              {{ formErrors.companyAddress }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Teléfono</span>
              <input type="text" class="form-control" formControlName="companyPhone" name="companyPhone" id="companyPhone" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.companyPhone" class="alert alert-danger">
              {{ formErrors.companyPhone}}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Pie de Impresión</span>
              <input type="text" class="form-control" formControlName="footerInvoice" name="footerInvoice" id="footerInvoice" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.footerInvoice" class="alert alert-danger">
              {{ formErrors.footerInvoice}}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">País</span>
              <select class="form-control" formControlName="country" name="country" id="country" (ngModelChange)="this.getTimeZone($event)">
                <option *ngFor="let country of countries"
                        [value]="country.alpha2Code">
                  {{country.name}}
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Zona Horaria</span>
              <select class="form-control" formControlName="timezone" name="timezone" id="timezone">
                <option *ngFor="let timezone of timezones"
                        [value]="timezone">
                  {{timezone}}
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <button type="submit" class="btn btn-primary" [disabled]="!configFormCompany.valid || loadingCompany">
              <i class="fa" [ngClass]="{'fa-save':!loadingCompany, 'fa-spinner fa-spin':loadingCompany}"></i>
              <span *ngIf="!loadingCompany">Guardar</span>
              <span *ngIf="loadingCompany">Espere por favor</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Email -->
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">Email</div>
    <div class='card-block'>
      <form [formGroup]="configFormEmail" #formAddConfig="ngForm" (ngSubmit)="addConfigEmail()" autocomplete="off">
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Cuenta de Mail</span>
              <input type="text" class="form-control" formControlName="emailAccount" name="emailAccount" id="emailAccount" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.emailAccount" class="alert alert-danger">
              {{ formErrors.emailAccount }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Contraseña de Mail</span>
              <input type="password" class="form-control" formControlName="emailPassword" name="emailPassword" id="emailPassword" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.emailPassword" class="alert alert-danger">
              {{ formErrors.emailPassword }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <button type="submit" class="btn btn-primary" [disabled]="!configFormEmail.valid || loadingEmail">
              <i class="fa" [ngClass]="{'fa-save':!loadingEmail, 'fa-spinner fa-spin':loadingEmail}"></i>
              <span *ngIf="!loadingEmail">Guardar</span>
              <span *ngIf="loadingEmail">Espere por favor</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Backup -->
  <!-- <div class="card card-outline-primary">
    <div class="card-header bg-primary">Respaldo</div>
    <div class= 'card-block'>
      <form [formGroup]="configFormBackup" #formAddConfig="ngForm" (ngSubmit)="addConfigBackup()" autocomplete="off">
        <div class="row">
          <div class="form-group col-md-12">
            <label for="backupTime" class="control-label">Hora del Backup:</label>
            <input type="time" class="form-control" formControlName="backupTime" name="backupTime" id="backupTime"/>
            <div *ngIf="formErrors.backupTime" class="alert alert-danger">
              {{ formErrors.backupTime }}
            </div>
          </div>
        </div>
        <div class= "row">
          <div class= "form-group col-md-12">
            <button type="submit" class="btn btn-primary" [disabled]="!configFormBackup.valid || loadingBackup" >
              <i class="fa" [ngClass]="{'fa-save':!loadingBackup, 'fa-spinner fa-spin':loadingBackup}"></i>
              <span *ngIf="!loadingBackup">Guardar</span>
              <span *ngIf="loadingBackup">Espere por favor</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div> -->

  <!-- Label -->
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">Etiquetas</div>
    <div class='card-block'>
      <form [formGroup]="configFormLabel" #formAddConfig="ngForm" (ngSubmit)="addConfigLabel()" autocomplete="off">
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Altura Etiqueta</span>
              <input type="text" class="form-control" formControlName="heightLabel" name="heightLabel" id="heightLabel" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.heightLabel" class="alert alert-danger">
              {{ formErrors.heightLabel }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1">Ancho Etiqueta</span>
              <input type="text" class="form-control" formControlName="widthLabel" name="widthLabel" id="widthLabel" aria-describedby="basic-addon1">
            </div>
            <div *ngIf="formErrors.widthLabel" class="alert alert-danger">
              {{ formErrors.widthLabel }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <button type="submit" class="btn btn-primary" [disabled]="!configFormLabel.valid || loadingLabel">
              <i class="fa" [ngClass]="{'fa-save':!loadingLabel, 'fa-spinner fa-spin':loadingLabel}"></i>
              <span *ngIf="!loadingLabel">Guardar</span>
              <span *ngIf="loadingLabel">Espere por favor</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- AFIP -->
  <div class="card card-outline-primary">
    <div class="card-header bg-primary">AFIP</div>
    <div class='card-block'>
      <form (ngSubmit)="generateCRS()" autocomplete="off">
        <div class="row">
          <div class="form-group col-md-1">
            <button type="submit" class="btn btn-primary" >
              <span *ngIf="!loading">Generar CRS</span>
              <span *ngIf="loading">Espere por favor</span>
            </button>
          </div>
          <div class="form-group col-md-2" [hidden]="!cert">
            <button type="button" class="btn btn-secundary"><a [attr.href]="'http://localhost:3000/api/download-file/' + this.routeFile">Descargar CRS</a></button>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-4" [hidden]="!cert">
            <input type="file" class="form-control" (change)="fileChangeEvent($event)" placeholder="Upload file..." />
            <button type="button" class="btn btn-secundary" (click)="upload()">Subir</button>
          </div>
        </div>
      </form>
    </div>
  </div>

</section>
