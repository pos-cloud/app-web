<section>
  <div class="row header-transaction">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-2" *ngIf="transaction.table">
          <b>Mesa:</b> {{transaction.table.description}}
        </div>
        <div class="col-md-2" *ngIf="posType==='mostrador' && transaction.type">
          <b>{{transaction.type.name}}</b>
        </div>
        <div class="col-md-2" *ngIf="transaction.employeeClosing">
          <b *ngIf="posType!=='resto'">Empleado:</b>
          <b *ngIf="posType==='resto'">Mozo:</b>
          {{transaction.employeeClosing.name}}
        </div>
        <div class="col-md-2" *ngIf="transactionMovement && transactionMovement ==='Venta'">
          <b>Cliente: </b>
          <span *ngIf="!transaction.company">Consumidor final</span>
          <span *ngIf="transaction.company">{{transaction.company.name}}</span>
        </div>
        <div class="col-md-2" *ngIf="posType==='resto'">
          <b>Comensales:</b>
          {{transaction.diners}}
        </div>
        <div class="col-md-2">
          <b *ngIf="posType!=='mostrador'">Abierto: </b>
          <b *ngIf="posType==='mostrador'">Fecha: </b>
          {{transaction.startDate | dateFormat:'DD/MM/YYYY HH:mm'}}
        </div>
        <div class="col-md-2" *ngIf="posType==='resto'">
          <a class="btn" (click)="openModal('change-employee')">
            <i class="fa fa-exchange"></i> Cambiar Empleado</a>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="center-content" *ngIf="alertMessage !== ''">
        <ngb-alert [type]="alertConfig.type" [dismissible]="alertConfig.dismissible" (close)="alertMessage=''">
          {{alertMessage}}
        </ngb-alert>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4 table-container">
      <div class="articles-container table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Cant</th>
              <th>Description</th>
              <th>Subtotal</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let movementOfArticle of movementsOfArticles" (click)="openModal('movement_of_article', movementOfArticle)">
              <td>{{movementOfArticle.amount}}</td>
              <td>{{movementOfArticle.description}}
                <strong *ngIf="movementOfArticle.notes">
                  <br> {{movementOfArticle.notes}}
                </strong>
              </td>
              <td>{{movementOfArticle.salePrice | currency:'USD':'1.2-2'}}</td>
              <td align=" left " width="20 ">
                <!-- <button type="button " class="btn btn-danger btn-sm " (click)="deleteMovementOfArticle(movementOfArticle._id) -->
                <!-- "><i class="fa fa-trash-o "></i></button> -->
              </td>
            </tr>
            <tr align="center " *ngIf="areMovementsOfArticlesEmpty ">
              <td colspan="10 ">Todavía no se cargaron productos al pedido</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row">
        <table class="table table-hover">
          <tbody>
            <tr>
              <td align="right">
                <h5>
                  <b>Subtotal</b>
                </h5>
              </td>
              <td align="right">
                <h5>
                  <b>{{(transaction.totalPrice+transaction.discountAmount) | currency:'USD':'1.2-2'}}</b>
                </h5>
              </td>
            </tr>
            <!-- <tr>
              <td align="right">
                <strong>Descuento</strong>
              </td>
              <td align="right">
                <strong>({{transaction.discountAmount | currency:'USD':'1.2-2'}})</strong>
              </td>
            </tr> -->
            <tr>
              <td align="right">
                <h3>
                  <b>TOTAL</b>
                </h3>
              </td>
              <td align="right">
                <h3>
                  <b>{{transaction.totalPrice | currency:'USD':'1.2-2'}}</b>
                </h3>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row" *ngIf="transactionMovement && transactionMovement !== 'Stock'">
        <div class="col-md-12 btn-action btn-large center-content" (click)="openModal('charge')">
          <span *ngIf="transactionMovement && transactionMovement ==='Compra'">Pagar</span>
          <span *ngIf="transactionMovement && transactionMovement ==='Venta'">Cobrar</span>
        </div>
      </div>
      <div class="row" *ngIf="transactionMovement && transactionMovement !== 'Stock'">
        <div class="col-md-6 btn-action btn-large center-content" (click)="openModal('add_client')">
          <span *ngIf="transactionMovement && transactionMovement ==='Compra'">Proveedor</span>
          <span *ngIf="transactionMovement && transactionMovement ==='Venta'">Cliente</span>
        </div>
        <div class="col-md-6 btn-action btn-large center-content" (click)="openModal('cancel_transaction')">
          Anular
        </div>
      </div>
      <div class="row" *ngIf="transactionMovement && transactionMovement === 'Stock'">
        <div class="col-md-12 btn-action btn-large center-content" (click)="updateRealStock()">
          <span>Procesar Stock</span>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="row filterArticle">
        <div class="col-md-12">
          <input type="text" class="form-control" [(ngModel)]="filterArticle" placeholder="Filtrar productos" (ngModelChange)="changeVisibilityArticle()" [focus]="focusEvent">
        </div>
      </div>
      <div class="row filterArticle">
        <div class="col-md-11">
          <nav class="breadcrumb">
            <span class="breadcrumb-item" [ngClass]="{'active':'areCategoriesVisible'}" (click)="showCategories()">Rubros</span>
            <span class="breadcrumb-item active" *ngIf="areArticlesVisible">Productos</span>
          </nav>
        </div>
        <div class="col-md-1 btn-action btn-large center-content" (click)="close()">
          Cerrar
        </div>
      </div>
      <div [ngClass]="{'row table-responsive img-container':areArticlesVisible}">
        <div class="col-md-12">
          <app-list-articles (eventAddItem)="addItem($event)" [areArticlesVisible]="areArticlesVisible" [filterArticle]="filterArticle"
            [filterCategorySelected]="categorySelected"></app-list-articles>
        </div>
      </div>
      <div [ngClass]="{'row table-responsive img-container':areCategoriesVisible}">
        <div class="col-md-12">
          <app-list-categories (eventSelectCategory)="showArticlesOfCategory($event)" [areCategoriesVisible]="areCategoriesVisible"></app-list-categories>
        </div>
      </div>
    </div>
  </div>
</section>

<!--MODAL IMPRESORA-->
<ng-template #contentPrinters let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Impresoras</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('close_click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="row">
          <ul class="list-group">
            <li class="list-group-item center-content" *ngFor="let printer of printersAux" (click)="c(printer)">{{printer.name}}</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('cancel')">Cancelar</button>
  </div>
</ng-template>

<!--MODAL ERROR IMPRESORA-->
<ng-template #contentMessage let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Error de conexión</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('close_click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body container-fluid">
    <div class="row">
      <div class="col-md-12">
        Ha ocurrido un error de conexión con la impresora.
        <br> ¿Desea continuar?
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('cancel')">Cancelar</button>
    <button type="submit" class="btn btn-primary" (click)="c('y')">
      <span>Sí</span>
    </button>
  </div>
</ng-template>